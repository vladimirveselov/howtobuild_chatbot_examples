<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="Windows-1251">
<title>„атбот “ест</title>
<meta name="description" content="„атботTest">
<meta name="author" content="¬ладимир ¬еселов">
<link href='http://fonts.googleapis.com/css?family=Neucha&subset=latin,cyrillic' rel='stylesheet' type='text/css'>
<style>
    body {
        font-family: 'Neucha', cursive;
        font-size: 28px;
        width: 900px;
        margin: 50px auto 50px auto;
      }
</style>
<script src="chatbot.js"></script>
<script async>
	var rule1 = new Rule(
		[ "хочу в отпуск" ], 
		null, 
		null,
		[ " упить авиа билеты?" ], 
		function () {
                  chatbot.dialogueId = " упитьЅилетыƒаЌет";   
                }, 
		null);
	chatbot.addRule(rule1);

	var ruleD1 = new Rule(
		[ "да", "конечно", "купить" ], 
		null, 
		null,
		[ " уда?" ], 
		function () {
                  chatbot.dialogueId = " упитьЅилеты уда";   
                }, 
		" упитьЅилетыƒаЌет");
	chatbot.addRule(ruleD1);

	var ruleD2 = new Rule(
		[ "нет", "передумал", "в другой раз" ], 
		null, 
		null,
		[ "Ќастроени€ людей переменчивы" ], 
                null,
		" упитьЅилетыƒаЌет");
	chatbot.addRule(ruleD2);

	var ruleDest1 = new Rule(
		[ "хочу лететь в","ћоскву","ќдессу","Ќью …орк","—анкт ѕетербург"], 
		null, 
		null,
		null, 
		function () { 
			var destinationRegex = 
			      /.* в (ћоскву|ќдессу|Ќью …орк|—анкт ѕетербург)/g; 
			var match = destinationRegex.exec(chatbot.question); 
			if (match != null) { 
				chatbot.memory.airTicket_destination= match[1];
				chatbot.response = " огда вы хотите лететь в " + 
					chatbot.memory.airTicket_destination + "?"; 
				chatbot.dialogueId = " упитьЅилеты огда";
			} else { 
				chatbot.dialogueId = " упитьЅилеты уда";
				chatbot.response = "Ќе совсем вас пон€л. ”точните куда вы хотите лететь.";
			}
		}, 
		" упитьЅилеты уда");
	chatbot.addRule(ruleDest1);

	var ruleDest2 = new Rule(
		[ "нет", "передумал", "в другой раз" ], 
		null, 
		null,
		[ "Ќастроени€ людей переменчивы" ], 
                null,
		" упитьЅилеты уда");
	chatbot.addRule(ruleDest2);

	var ruleWhen1 = new Rule(
		[ "завтра","на следующей неделе","после завтра","после после завтра","default"], 
		null, 
		null,
		null, 
		function () { 
			var whenRegex = 
			      /(завтра|на следующей неделе|послезавтра|после послезавтра)/g; 
                        console.log("|" + chatbot.question +"|");
			var match = whenRegex.exec(chatbot.question); 
			if (match != null) { 
				var whenVerbal = match[1];                             
                                switch(whenVerbal) {
					case "завтра":
						chatbot.memory.airTicket_when= new Date(new Date().getTime() + 24 * 60 * 60 * 1000);
						break;
					case "на следующей неделе":
						chatbot.memory.airTicket_when= new Date(new Date().getTime() + 7 * 24 * 60 * 60 * 1000);
						break;
					case "после завтра":
						chatbot.memory.airTicket_when= new Date(new Date().getTime() + 2 * 24 * 60 * 60 * 1000);
						break;
					case "после после завтра":
						chatbot.memory.airTicket_when= new Date(new Date().getTime() + 3 * 24 * 60 * 60 * 1000);
                                }
				var day = chatbot.memory.airTicket_when.getDate();
				var month = chatbot.memory.airTicket_when.getMonth() + 1;
				var year = chatbot.memory.airTicket_when.getFullYear();
				chatbot.memory.airTicket_whenString = day + "/" + month + "/" + year;
				chatbot.response = "ƒата вылета: " + 
					chatbot.memory.airTicket_whenString + ". —колько билетов заказать?"; 
				chatbot.dialogueId = " упитьЅилеты—колько";
			} else { 
				chatbot.dialogueId = " упитьЅилеты огда";
				chatbot.response = "Ќе совсем вас пон€л. ”точните когда вы хотите лететь.";
			}
		}, 
		" упитьЅилеты огда");
	chatbot.addRule(ruleWhen1);

	var ruleWhen2 = new Rule(
		[ "нет", "передумал", "в другой раз" ], 
		null, 
		null,
		[ "Ќастроени€ людей переменчивы" ], 
                null,
		" упитьЅилеты огда");
	chatbot.addRule(ruleWhen2);

	var ruleHowMany1 = new Rule(
		[ "один","два","три","четыре","default"], 
		null, 
		null,
		null, 
		function () { 
			var howManyRegex = 
			      /(один|два|три|четыре)/g; 
			var match = howManyRegex.exec(chatbot.question); 
			if (match != null) { 
				chatbot.memory.airTicket_howMany= match[1];
				chatbot.response = "«аказываю " + 
					chatbot.memory.airTicket_howMany + " билета в " +
                                        chatbot.memory.airTicket_destination + 
                                        ". ƒата вылета:" +
					chatbot.memory.airTicket_whenString; 
			} else { 
				chatbot.dialogueId = " упитьЅилеты—колько";
				chatbot.response = "Ќе совсем вас пон€л. —колько нужно билетов?";
			}
		}, 
		" упитьЅилеты—колько");
	chatbot.addRule(ruleHowMany1);

	var ruleHowMany2 = new Rule(
		[ "нет", "передумал", "в другой раз" ], 
		null, 
		null,
		[ "Ќастроени€ людей переменчивы" ], 
                null,
		" упитьЅилеты—колько");
	chatbot.addRule(ruleHowMany2);

	var ruleDef = new Rule([ "default" ], null, null, [ "не пон€л" ], null,
			null);
	chatbot.addRule(ruleDef);

	var questions = [];
	questions.push("’очу в отпуск");
	questions.push("ƒа");
	questions.push("хочу лететь в —анкт ѕетербург");
	questions.push("завтра");
	questions.push("три");
	questions.push("’очу в отпуск");
	questions.push("Ќет");
	questions.push("’очу в отпуск");
	questions.push("ƒа");
	questions.push("хочу лететь в ѕариж");
	questions.push("хочу лететь в ќдессу");
	questions.push("вчера");
	questions.push("на следующей неделе");
	questions.push("п€ть");
	questions.push("четыре");

	setTimeout(doStuff, 3000);

	function doStuff() {
		var div = document.getElementById('holder');
		div.innerHTML = "<br>";
		for (var i = 0, x = questions.length; i < x; i++) {
			div.innerHTML += "„еловек: " + questions[i] + "<br>";
			console.log("„атбот: " + questions[i]);
			chatbot.answer(questions[i])
			div.innerHTML += "ќтвет: " + chatbot.response + "<br>";
			console.log("ответ: " + chatbot.response);
			console.log("context: " + chatbot.context);
			console.log("dialogueId: " + chatbot.dialogueId);
		}
	}
</script>
</head>
<body>
  <p>ƒиалог - купить авиа билет</p>
  <div id='holder'>
    <p>
  </div>
</body>
</html>